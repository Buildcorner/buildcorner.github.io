function createMarker(e){var n=document.createElement("canvas");n.id="number"+e,n.width=64,n.height=64,n.style.zIndex=-1,n.style.position="absolute";var t=n.getContext("2d"),i=2*Math.PI;return t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.arc(32,32,30,0,i),t.fill(),t.strokeStyle="rgb(255, 255, 255)",t.lineWidth=3,t.beginPath(),t.arc(32,32,30,0,i),t.stroke(),t.fillStyle="rgb(255, 255, 255)",t.font="32px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText(e,32,32),body=document.getElementsByTagName("body")[0],body.appendChild(n),n}var camera=void 0,controls=void 0,scene=void 0,renderer=void 0,mesh=void 0,spriteBehindObject=void 0,annotation=document.querySelector("#tooltip"),sprites=[],markers=[],anotationTitle=void 0,anotationTypicalValue=void 0,anotationHightValue=void 0,anotationLowValue=void 0,lastHover=void 0;function init(){(camera=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,2,2e3)).position.x=750,camera.position.y=500,camera.position.z=-1250,scene=new THREE.Scene;var e=new THREE.DirectionalLight(16777215,1);e.castShadow=!0,scene.add(e);var n=new THREE.AmbientLight(16777215,1.5);scene.add(n);var t=new THREE.JSONLoader,i=(new THREE.TextureLoader).load("./model/machineMap.jpg");t.load("./model/machine2.js",function(e){var n=new THREE.MeshStandardMaterial;n.map=i,n.metalness=.4,n.roughness=.8,e.faceVertexUvs[1]=e.faceVertexUvs[0],mesh=new THREE.Mesh(e,n),scene.add(mesh),(markers=[{id:0,name:1,tooltip:"Production Ok Quantity (Chamber A & B )",x:240,y:100,z:-110},{id:1,name:2,tooltip:"Rejects",x:77,y:118,z:-14.8},{id:2,name:3,tooltip:"Helium & air Pressure",x:-109,y:-139,z:-196},{id:3,name:4,tooltip:"Cycle Time",x:-286,y:96,z:69},{id:4,name:5,tooltip:"Helium Concentration",x:16,y:-63,z:191}]).forEach(e=>{var n=createMarker(e.name),t=new THREE.CanvasTexture(n),i=new THREE.SpriteMaterial({map:t,alphaTest:.5,transparent:!0,depthTest:!1,depthWrite:!1}),o=new THREE.Sprite(i);o.name=e.name,o.position.set(e.x,e.y,e.z),o.scale.set(60,60,1),scene.add(o),sprites.push(o)}),document.getElementById("preloader").style.display="none"}),(renderer=new THREE.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.setClearColor(16777215,1),document.body.appendChild(renderer.domElement),(controls=new THREE.OrbitControls(camera,renderer.domElement)).enableZoom=!1,window.addEventListener("resize",onWindowResize,!1),document.addEventListener("mousedown",onMouseDown,!1),document.addEventListener("mousemove",onMouseMove,!1)}function onMouseMove(e){var n=new THREE.Raycaster,t=new THREE.Vector2;t.x=event.clientX/window.innerWidth*2-1,t.y=-event.clientY/window.innerHeight*2+1,n.setFromCamera(t.clone(),camera);var i=n.intersectObjects(sprites,!0);i.length>0?(showToolTip((lastHover=i[0].object).position,markers[lastHover.name-1].tooltip),lastHover.material.color.setHex(696831)):(hideToolTip(),lastHover&&(lastHover.material.color.setHex(16777215),lastHover=null))}function onMouseDown(e){var n=new THREE.Raycaster,t=new THREE.Vector2;t.x=event.clientX/window.innerWidth*2-1,t.y=-event.clientY/window.innerHeight*2+1,n.setFromCamera(t.clone(),camera);var i=n.intersectObjects(sprites,!0);i.length>0?(console.log(i[0].object),showLoadingNotice(i[0].object.name),updateNotice(i[0].object.name)):console.log("No click")}function showLoadingNotice(e){document.getElementById("stats").style.display="block",document.getElementById("index").innerHTML=e,document.getElementById("title").innerHTML=markers.find(n=>n.name==e).tooltip,document.getElementById("typical_value").innerHTML="Loading...",document.getElementById("high_value").innerHTML="Loading...",document.getElementById("low_value").innerHTML="Loading..."}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate),controls.update(),render()}function render(){renderer.render(scene,camera),updateAnnotationOpacity()}function updateNotice(e){Tabletop.init({key:"https://docs.google.com/spreadsheets/d/1iOvizNNvZNpwMS2JNPP0HJ0zSTHh9uLOHApUQGgtCms/pubhtml",callback:function(n,t){var i=n[markers.find(n=>n.name==e).id];document.getElementById("stats").style.display="block",document.getElementById("index").innerHTML=e,document.getElementById("title").innerHTML=i["Variable / Parameter"],document.getElementById("typical_value").innerHTML=i["Typical Value"],document.getElementById("high_value").innerHTML=i["High Value"],document.getElementById("low_value").innerHTML=i["Low Value"]},simpleSheet:!0})}function updateAnnotationOpacity(){if(mesh){var e=camera.position.distanceTo(mesh.position);sprites.forEach(n=>{var t=camera.position.distanceTo(n.position);spriteBehindObject=t>e,n.material.opacity=spriteBehindObject?0:1})}}function hideToolTip(){annotation.style.opacity=0}function showToolTip(e,n){annotation.innerHTML=n;var t=e.clone(),i=renderer.domElement;t.project(camera),t.x=Math.round((.5+t.x/2)*(i.width/window.devicePixelRatio)),t.y=Math.round((.5-t.y/2)*(i.height/window.devicePixelRatio)),annotation.style.top=t.y+"px",annotation.style.left=t.x+"px",annotation.style.opacity=1}init(),animate();